// This is your Prisma schema file,
// learn more about it in the docs: https://pris.ly/d/prisma-schema

generator client {
  provider = "prisma-client-js"
}

datasource db {
  provider = "postgresql"
  url      = env("DATABASE_URL")
}

// === AUTH MODELS ===
enum UserRole {
  GERENTE
  AYUDANTE
  ASISTENTE
}

model User {
  id              Int      @id @default(autoincrement())
  username        String   @unique
  password        String
  email           String?  @unique
  firstName       String?
  lastName        String?
  phoneNumber     String?
  avatarUrl       String?
  role            UserRole @default(AYUDANTE)
  isActive        Boolean  @default(true)
  isAuthenticated Boolean  @default(false)
  createdAt       DateTime @default(now())
  updatedAt       DateTime @updatedAt

  @@map("users")
}

// === PRODUCT/INVENTORY MODELS ===
model Product {
  id               Int       @id @default(autoincrement())
  codigo           String    @unique
  nombre           String
  costoUnitario    Float
  ubicacion        String
  entradas         Int       @default(0)
  salidas          Int       @default(0) 
  stockActual      Int       @default(0)
  stockMinimo      Int       @default(0)
  unidadMedida     String
  providerId       Int       // Foreign key
  marca            String?
  costoTotal       Float     @default(0)
  categoria        String?
  alertaVista      Boolean   @default(false)
  alertaVistaFecha DateTime?
  deletedAt        DateTime? // Null = Activo, Fecha = Eliminado
  createdAt        DateTime  @default(now())
  updatedAt        DateTime  @updatedAt

  // Relations
  provider         Provider  @relation(fields: [providerId], references: [id])
  movementEntries  MovementEntry[]
  movementExits    MovementExit[]

  @@map("products")
}

// === MOVEMENT MODELS ===
model MovementEntry {
  id             Int      @id @default(autoincrement())
  fecha          String   // Format: "DD/MM/YYYY"
  codigoProducto String
  descripcion    String
  precioUnitario Float
  cantidad       Int
  responsable    String?
  area           String?
  categoria      String?
  
  deletedAt      DateTime?
  
  createdAt      DateTime @default(now())
  updatedAt      DateTime @updatedAt

  // Relations
  product        Product  @relation(fields: [codigoProducto], references: [codigo])

  @@map("movement_entries")
}

model MovementExit {
  id             Int      @id @default(autoincrement())
  fecha          String   // Format: "DD/MM/YYYY"
  codigoProducto String
  descripcion    String
  precioUnitario Float
  cantidad       Int
  responsable    String?
  area           String?
  proyecto       String?
  categoria      String?
  
  deletedAt      DateTime?
  
  createdAt      DateTime @default(now())
  updatedAt      DateTime @updatedAt

  // Relations
  product        Product  @relation(fields: [codigoProducto], references: [codigo])

  @@map("movement_exits")
}

// === EQUIPMENT MODELS ===
enum EstadoEquipo {
  Bueno
  Regular
  Malo
  En_Reparacion
  Danado
}

model EquipmentReport {
  id                 Int          @id @default(autoincrement())
  equipo             String
  serieCodigo        String
  cantidad           Int
  estadoEquipo       EstadoEquipo
  responsable        String
  fechaSalida        String
  horaSalida         String
  areaProyecto       String
  fechaRetorno       String?
  horaRetorno        String?
  estadoRetorno      EstadoEquipo?
  responsableRetorno String?
  createdAt          DateTime     @default(now())
  updatedAt          DateTime     @updatedAt

  @@map("equipment_reports")
}

// === PROVIDERS MODEL ===
model Provider {
  id        Int      @id @default(autoincrement())
  name      String
  email     String   @unique
  address   String
  phones    String[] // Array de strings para múltiples teléfonos
  photoUrl  String?
  
  deletedAt DateTime?
  
  createdAt DateTime @default(now())
  updatedAt DateTime @updatedAt

  // Relations
  products  Product[]

  @@map("providers")
}

// === CONFIGURATION MODELS ===
model Area {
  id     Int    @id @default(autoincrement())
  nombre String @unique

  @@map("areas")
}

model Categoria {
  id     Int    @id @default(autoincrement())
  nombre String @unique

  @@map("categorias")
}

// === PURCHASE ORDER MODELS ===
enum PurchaseOrderStatus {
  BORRADOR
  ENVIADA
  RECIBIDA
  CANCELADA
}

model PurchaseOrder {
  id             Int                 @id @default(autoincrement())
  codigo         String              @unique
  fecha          String              // Format: "DD/MM/YYYY"
  proveedor      String?
  estado         PurchaseOrderStatus @default(BORRADOR)
  cantidad       Int                 @default(0) // Suma de cantidades de productos
  costo          Float               @default(0) // Suma de costos de productos
  observaciones  String?
  deletedAt      DateTime?
  createdAt      DateTime            @default(now())
  updatedAt      DateTime            @updatedAt

  // Relations
  productos      PurchaseOrderProduct[]

  @@map("purchase_orders")
}

model PurchaseOrderProduct {
  id               Int      @id @default(autoincrement())
  purchaseOrderId  Int
  fecha            String   // Format: "DD/MM/YYYY"
  codigo           String   // Puede ser código de producto o vacío para productos no registrados
  nombre           String
  area             String
  proyecto         String
  responsable      String
  cantidad         Int
  costoUnitario    Float
  subtotal         Float    // cantidad * costoUnitario
  deletedAt        DateTime?
  createdAt        DateTime @default(now())
  updatedAt        DateTime @updatedAt

  // Relations
  purchaseOrder    PurchaseOrder @relation(fields: [purchaseOrderId], references: [id], onDelete: Cascade)

  @@map("purchase_order_products")
}